{# Reusable plan card include. Expects `plan` dict with fields: id, amount, profit. Optional: popular, investors, views, rating, funded_pct #}
<article class="plan-card-detailed">
  {# determine currency symbol: user preference > session > default â‚¦ #}
  {% set cs = (user['currency_symbol'] if user and ('currency_symbol' in user) else session.get('currency_symbol')) or 'â‚¦' %}
  {% if (plan is mapping and plan.popular) or (popular|default(false)) %}
    <div class="badge">ðŸ”¥ Most Popular</div>
  {% endif %}
  <header class="plan-head">
    <div class="plan-name"><a href="/plans/{{ plan.id }}">{{ plan.name|default('PLAN') }} â€“ {{ plan.duration|default('2 Day') }}</a></div>
  </header>

  <div class="plan-roi">
    <div class="invest-label">Invest <span class="amount">{{ cs }}{{ '%.2f'|format(plan.display_amount if plan.display_amount is not none else (plan.amount|default(1000))) }}</span></div>
    <div class="gets">Get <span class="get-amount">{{ cs }}{{ '%.2f'|format(plan.display_profit if plan.display_profit is not none else (plan.profit|default(plan.amount + 300))) }}</span></div>
  </div>

  <div class="social-proof">
    <span class="proof"><svg class="icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg> {{ plan.investors|default(245) }}</span>
    <span class="proof"><svg class="icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path fill="currentColor" d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg> {{ plan.views|default(12540) }}</span>
    <span class="proof"><svg class="icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path fill="currentColor" d="M12 17.27L18.18 21 16.54 13.97 22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg> {{ plan.rating|default('4.8') }}</span>
  </div>

  <div class="plan-details">
    <div>Duration: <strong>{{ plan.duration|default('2 Days') }}</strong></div>
    <div>Profit: <strong>{{ cs }}{{ '%.2f'|format(((plan.profit - plan.amount) if (plan.profit is defined and plan.amount is defined) else 300)) }}</strong></div>
    <div>Capital Back: <strong>{{ 'Yes' if plan.capital_back|default(true) else 'No' }}</strong></div>
  </div>

  {% set pct = (plan.funded_pct|default(0.75)) %}
  <div class="funding">
    <div class="funding-row">
      <div class="funding-label">{{ (pct*100)|round(0) }}% Funded</div>
      <div class="funding-bar" aria-hidden="true">
        <div class="funding-fill" style="width:{{ (pct*100)|round(0) }}%"></div>
      </div>
    </div>
  </div>

  {% if plan.countdown_end is defined and plan.countdown_end %}
    <div class="countdown" data-end="{{ plan.countdown_end }}" aria-live="polite">Offer ends in: <span class="countdown-timer">--:--:--</span></div>
  {% endif %}

  <div class="plan-action">
    <a class="btn invest-btn" href="/plans/{{ plan.id }}">ðŸš€ Invest Now</a>
  </div>
</article>
